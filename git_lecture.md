# Git Lecture

ここはGitの講義用リポジトリになります。
講義は以下の内容にしたがって一部ハンズオン形式で行われます。
なるべくテキストをシンプルに保つために、以下のテキストにはGitに関する基本的な説明は含まれていないので、講演者から説明を受けてください。

## 受講対象者

- Gitによるソースコード管理をしたことがない、もしくは経験が不足していると感じている方。

## 前提条件

- 自身のコンピューター上にGit(version 2.23以上)がインストールされている。

## Chapter 1: ローカルリポジトリの作成

Gitはソースコードのバージョン管理ツールです。
Gitでソースコードの管理を開始するための最初のステップはリポジトリと呼ばれる履歴全体を保存するための格納庫を作成することです。
任意のCLIで以下のコマンドを実行し、自身のPC上にローカルリポジトリを作成してください。

```sh:
git init
# git initコマンドは空のディレクトリ以外の場所で実行した場合失敗します。
# 実行前に任意の空ディレクトリを作成し、cdコマンドなどでその中に移動してから作業するようにしてください。
```

上記が完了したら、次はあなたの名前とメールアドレスを`./.git/config`に追加します

```sh:
git config --local user.name YOUR_NAME
git config --local user.email YOUR_EMAIL

# --local オプションは現在作業中のリポジトリにのみ適用するためのオプションです。
# このオプションがなくてもデフォルトで同様の動作になりますが、ここでは念の為明示的に指定しています。
```

次にGitで使用するエディタを設定します。
設定されたエディタは、何かしらのGitコマンド実行時にエディタ上での編集が必要になった場合に自動で立ち上がります。

```sh:
git config core.editor YOUR_FAVORITE_EDITOR
# 例: git config core.editor vi
```

## Chapter 2: ブランチの作成

リポジトリの作成が終わると自動で１つのブランチが作成されます。
ブランチはリポジトリの状態を複数保持することを可能にします。
例えば、

- 本番環境と同じソースコードを持つ、`master`ブランチ
- 開発が完了した機能のソースコードなどを反映させ検証するための、`staging`ブランチ
- 開発中の機能のソースコードを集約・管理するための、`develop`ブランチ
- 開発中の各機能ごとに存在する、`feature/any_featuer_name`ブランチ
- バグに対応するための修正に使用する、`hotfix/any_bug_name`ブランチ

などです。
ブランチの名前はそれぞれ任意に設定できますし、いつでも変更・追加が可能です。
この講義でも実際の開発に近しい流れで進行するために、以下のコマンドで新しいブランチを作成しましょう。

```sh:
# 現在のブランチとその他のブランチのリストを確認
git branch

# ブランチを新規作成し、作成したブランチへ切替
git switch -c any_branch_name
# any_branch_name部分は任意の名前を設定してください
```

`git switch`コマンドに`-c`オプションを追加することによって、ブランチの作成と切り替えが同時に実行されます。
単純に別のブランチへ切り替えたいだけの場合は`-c`オプションをつけずに実行することで実現できます。

## Chapter 3: 変更履歴の作成

Gitに自身の変更履歴を追加するには2つのステップが必要です。
まずは任意のエディタで何かしらの変更を加えてください。
思いつかない場合は`README.md`ファイルを作成し、以下のコマンドを実行してください。
```sh:
echo '# Git lesson'> README.md
```

次に変更を履歴に保存します。
以下のコマンドを実行してください。

```sh:
git add README.md
# 上記コマンドはREADME.mdファイルの変更のみをaddします。
# 複数ファイルの変更を一度にaddしたい場合は以下。
# git add .
```

`git add`を実行した段階ではまだ履歴に保存されてはいません。
このコマンドは指定ファイルの現在の状態を記録し、履歴に保存する前段階であるstagingと呼ばれる状態にします。
これは履歴に残す変更を選別するための仕組みです。
gitの状態や変更差分の確認をする際は以下のコマンドを実行してください。

```sh:
# 状態を確認
git status

# 差分を確認
git diff HEAD
```

次のコマンドを実行することで実際に履歴へ保存します。

```sh:
git commit -m 'any commit message'
```

`git commit`を使用する際、`-m`オプションを使用しコミットメッセージを設定してください。
コミットメッセージは通常、変更内容についての概要を短い文で表現するために用いられます。
`-m`オプションを使用しなかった場合、コミットメッセージを入力するためのエディタが自動で立ち上がります。
保存が終了したら、以下のコマンドで履歴を確認しましょう。

```sh: 
git log
```

## Chapter 4: Gitホスティングサービスの利用

ここで一旦CLIから離れましょう。
ここまでで、あなたのソースコードをバージョン管理することが可能になりました。
しかしこのままでは、もしコンピューターがクラッシュしてしまった場合、全てのソースコードは失われてしまうでしょう。
もしくは別のコンピューターでソースコードを取得したい場合、わざわざメールサービスなどに添付して転送する必要があります。
Gitをより効果的に使用するためにはGitのホスティングサービスの利用が有効です。
Gitのホスティングサービスは色々ありますが、今回の講義ではGitHubを使用したいと思います。

以下の手順によりGitHubの使用を開始し、必要な設定を完了してください。
(既にGitHubへの登録が完了している場合は次のCapterへ進んでください)

1. `https://github.com/` にアクセス
2. 入力用ボックスに登録用のメールアドレスを入力し、 [Sign up for GitHub] をクリック
3. 必要項目を入力し、[Create account] ボタンをクリック
4. Welcome画面が表示されるので、下のほうにスクロールして [Complete setup] をクリック
5. 入力したメールアドレス宛に確認メールが送信されているので、本文中の [Verify email address] をクリック

## Chapter 5: GitHubへのSSHキー登録

前回のChapterでGitHubへの登録は完了したと思います。
ですがGitHubから自身のコンピューター上にソースコードを複製したり、編集した内容をGitHubのリポジトリに反映させたりしたい場合、GitHubと通信するための認証が必要になります。
認証方法はGitHubとの通信プロトコル(httpsやssh)によって異なります。
GitHubの推奨はhttpsとパーソナルトークンを使用した通信方法ですが、実際の開発現場ではSSHを使用するほうが多いと思います。
なので今回はSSHでの接続設定を行っていきます。
下記の手順、またはGitHub公式が公開している手順にしたがって設定を行ってください。(GitHub公式リファレンス: [GitHub に SSH で接続する](https://docs.github.com/ja/authentication/connecting-to-github-with-ssh))
下記はMacOSまたはLinuxを使用した際の手順になります。
WindowsOSでのWSLやPowerShellを使用した手順は別途ご自身で調べてください。
(既にSSH keyの登録が完了している場合は次のCapterへ進んでください)

1. CLIウィンドウを開く
2. 下記コマンドを実行
    ```sh:
    ssh-keygen -t ed25519 -f ~/.ssh/github
    # パスフレーズを聞かれるのでフレーズを入力し、それを忘れないようにしてください。

    echo 'Host github.com' >> ~/.ssh/config
    echo '  HostName github.com' >> ~/.ssh/config
    echo '  User git' >> ~/.ssh/config
    echo '  HostName github.com' >> ~/.ssh/config
    echo '  IdentityFile ~/.ssh/github' >> ~/.ssh/config
    echo '  IdentitiesOnly yes' >> ~/.ssh/config
    # 上記でsshのconfigファイルを編集しています。これによりgithub.comとのSSH接続時にどのキーファイルを使うかを自動で選択してくれます。
    ```
3. 自動作成された`~/.ssh/github.pub`ファイル内のテキストを全てコピー
4. `https://github.com/settings/keys` にアクセスし [New SSH key] をクリック
5. Titleを適当に入力しKeyの入力エリアに、先程コピーしたテキストをペースト
6. [Add SSH key]をクリック

## Chapter 6: リモートリポジトリの作成

GitHubへのSSH接続が可能になったので、次にGitHub上にもリポジトリを作成したいと思います。

1.GitHubにサインインした状態で`https://github.com/`にアクセス
2. Recent Repositories の横にある[New]をクリック
3. Repository name に任意の文字列を入力
4. Private を選択
5. [Create repository]ボタンをクリック

## Chapter 7: リモートリポジトリとの同期

リモートリポジトリの作成が完了したら、自身のコンピューター上にあるローカルリポジトリと同期させていきましょう。
まずはリモートリポジトリの同期先情報をコピーします。
GitHubで作成したリポジトリの管理画面を開き、[Code]をクリック。
SSHを選択し、表示されたテキストをコピーしてください。(例: git@github.com:USER_NAME/REPOSITORY_NAME)

次に以下のコマンドを任意のCLIで実行します。

```sh:
git remote add origin COPIED_TEXT
# COPIED_TEXT は先程コピーした内容に置き換えてください。
```

これであなたのローカルリポジトリに同期先のリモートリポジトリが設定されました。
以下のコマンドで現在のローカルリポジトリの状態をリモートリポジトリに反映してみましょう。

```sh:
git push -u origin YOUR_CREATED_BRANCH
# `-u`オプションは上流ブランチを設定します。
# これでこのブランチでは次回から`git push`のみで、自動的にリモートリポジトリの同名ブランチへpushされるようになります。
```

GitHub上のあなたのリポジトリを確認してみてください。
あなたがローカルで作成したブランチが１つ追加され、ファイルの内容も同じになっているはずです。

## Chapter 8: リポジトリのクローン

ここで、一度学んだことを整理しましょう。

1. 自身のコンピューター上(ローカル)でリポジトリを作成
2. 開発用ブランチの作成と切り替え
3. addとcommitコミットコマンドによる変更履歴の作成
4. Gitのホスティングサービスを利用したリモートリポジトリの作成
5. ローカルリポジトリとリモートリポジトリの同期

これらは個人開発でも必要になる知識です。
それでは、ここからはチーム開発で必要になる知識を学んでいきましょう。

あなたがチームの開発に参加したとします。
その際、誰かが既にリモートリポジトリを作成し、いくつかの変更履歴(コミット履歴)があるとします。
まず、あなたはこれらの内容を複製したローカルリポジトリを、自身のコンピューター上に配置しなくてはなりません。
その際に使用されるコマンドが`git clone`です。

今回は、ここまでの講義で作成したリモートリポジトリをクローンしてみましょう。
すでにリモートリポジトリと同期したローカルリポジトリが存在しますが、一旦こちらのディレクトリの名前をリモートリポジトリの名前と別の名前に変更しておいてください。 (元々別名の場合はそのままでかまいません)
ちなみにもうおわかりかもしれませんが、ローカルリポジトリとはあなたが最初に`git init`を実行したディレクトリのことです。

その後、GitHubのリポジトリの管理画面を開き、[Code]をクリック。
SSHを選択し、表示されたテキストをコピーしてください。(例: git@github.com:USER_NAME/REPOSITORY_NAME)
さらに以下のコマンドを自身のCLIで実行します。

```sh:
git clone COPIED_TEXT
# COPIED_TEXT は先程コピーした内容に置き換えてください。
```

`git clone`を実行したディレクトリ配下に、リポジトリ名と同じディレクトリが作成されていれば成功です。
それがリモートリポジトリを複製してできたローカルリポジトリです。
そのディレクトリに移動したあと、`git log`コマンドなどで履歴を確認してみてください。リモートの内容と同じはずです。

## Chapter 9: 他人の変更をpullする

今あなたのコンピューター上に２つのローカルリポジトリがあります。
普通こんなことはしません。あくまでチーム開発を経験する講義のためであることを認識してください。
仮に、最初に作成したローカルリポジトリを「開発者A」のコンピューター上にあるリポジトリ、さきほど作成したものを「開発者B」のコンピューター上にあるリポジトリのようにイメージするといいでしょう。

他人がリモートリポジトリに反映した変更履歴を取り込むためにはローカルリポジトリ内で`git pull`コマンドを使用し、変更内容を引っ張ってくる必要があります。
実演してみましょう。

まずは「開発者A」のリポジトリに移動し、ファイルに何かしらの変更を加えてください。
その後、この講義で教えたことを参考に、`git add`, `git commit`, `git push`を使用し、リモートリポジトリに反映させてください。

リモートリポジトリへの反映が確認できたら、今度はその変更を「開発者B」のリポジトリへ取り込みます。
「開発者B」のリポジトリに移動し、`git switch`を使用して、変更を加えたブランチに切り替えてください。
念の為、この時点でのログを確認しましょう。`git log`を実行してください。
まだ「開発者A」で行った変更はありませんね？
では、以下のコマンドを使用してください。

```sh:
git pull
```

`git log`でログを確認してください。
「開発者A」で行った変更が無事確認できれば成功です。

## Chapter 10: MRの作成とMerge
