# Git Lecture

ここはGitの講義用リポジトリになります。
講義は以下の内容にしたがって一部ハンズオン形式で行われます。
なるべくテキストをシンプルに保つために、以下のテキストにはGitに関する基本的な説明があまり含まれていない可能性があるので、気になる方は講演者から説明を受けてください。

## 受講対象者

- Gitによるソースコード管理をしたことがない、もしくは経験が不足していると感じている方。

## 前提条件

- 自身のコンピューター上にGit(version 2.23以上)がインストールされている。

## 備考

- このドキュメントで使用されるコマンドは一部、LinuxもしくはMacで使用されるコマンドになります。WindowsでWSL以外のCLIをお使いの方などは、適宜別のコマンドに置き換えて実行してください。

## Chapter 1: ローカルリポジトリの作成

Gitはソースコードのバージョン管理ツールです。
Gitでソースコードの管理を開始するための最初のステップはリポジトリと呼ばれる履歴全体を保存するための格納庫を作成することです。
任意のCLIで以下のコマンドを実行し、自身のPC上にローカルリポジトリを作成してください。

```sh
git init
# git initコマンドは空のディレクトリ以外の場所で実行した場合失敗します。
# 実行前に任意の空ディレクトリを作成し、cdコマンドなどでその中に移動してから作業するようにしてください。

# 次に空commitを実行します。commitに関してはあとで説明するので、今は何も考えずに以下のコマンドを実行してください。
git commit --allow-empty -m "first commit"
```

上記が完了したら、次は名前とメールアドレスを`./.git/config`に追加します

```sh
git config --local user.name YOUR_NAME
git config --local user.email YOUR_EMAIL

# --local オプションは現在作業中のリポジトリにのみ適用するためのオプションです。
# このオプションがなくてもデフォルトで同様の動作になりますが、ここでは念の為明示的に指定しています。
```

次にGitで使用するエディタを設定します。
設定されたエディタは、何かしらのGitコマンド実行時にエディタ上での編集が必要になった場合に自動で立ち上がります。

```sh
git config core.editor YOUR_FAVORITE_EDITOR
# 例: git config core.editor vi
```

## Chapter 2: ブランチの作成

リポジトリの作成が終わると自動で１つのブランチが作成されます。
`git branch`コマンドを実行してみてください。
おそらく`master`ブランチの存在が確認できるでしょう。

「ブランチとは何か？」を理解するには「製造ライン」をイメージするといいでしょう。
ブランチはそれぞれ別のコミット履歴を保持することができます。
コミット履歴は製造ラインにおける「各工程」部分です。
複数のブランチを作成することにより、リポジトリは複数の異なる製造ラインを所持することを可能にします。
例えば、

- 本番環境で使用される、`master`ブランチ
- 検証用の、`staging`ブランチ
- 開発中の各機能のコミット履歴を保持するためのブランチ(例: `feature/any_featuer_name`)
- バグ修正用のコミット履歴を保持するブランチ(例: `hotfix/any_bug_name`)

などです。
ブランチの名前はそれぞれ任意に設定できますし、いつでも変更・追加・削除が可能です。
この講義でも実際の開発に近しい流れで進行するために、以下のコマンドで新しいブランチを作成しましょう。

```sh
# ブランチを新規作成し、作成したブランチへ切替
git switch -c lesson/how_to_use_git

# version 2.23より古いバージョンを使用している方は代わりに以下のコマンドを実行してください。
git checkout -b lesson/how_to_use_git
```

`git switch`コマンドに`-c`オプションを追加することによって、ブランチの作成と切り替えが同時に実行されます。
単純に別のブランチへ切り替えたいだけの場合は`-c`オプションをつけずに実行することで実現できます。

## Chapter 3: 変更履歴の作成

Gitに自身の変更履歴を追加するには2つのステップが必要です。
まずは以下のコマンドを実行してください。
```sh
echo '# Git lesson' > README.md
```

次に変更内容を記録したいファイルを選択します。
以下のコマンドを実行してください。

```sh
git add README.md
# 複数ファイルの変更を一度にaddしたい場合は以下。
# git add .
```

`git add`を実行した段階ではまだ履歴に保存されてはいません。
このコマンドは指定ファイルの現在の状態を記録し、履歴に保存する前段階であるstagingと呼ばれる状態にします。
これは必要な変更のみを履歴に残すための仕組みです。
gitの状態や変更差分の確認をする際は以下のコマンドを実行してください。

```sh
# 状態を確認
git status

# 差分を確認
git diff HEAD
```

次のコマンドを実行することで履歴を作成します。

```sh
git commit -m 'create reademe file'
```

`git commit`を使用する際、`-m`オプションを使用しコミットメッセージを設定してください。
コミットメッセージは通常、変更内容についての概要を説明するために用いられます。
`-m`オプションを使用しなかった場合、コミットメッセージを入力するためのエディタが自動で立ち上がります。
commitが完了したら、以下のコマンドで履歴を確認しましょう。

```sh 
git log
```

## Chapter 4: Gitホスティングサービスの利用

ここで一旦CLIから離れましょう。
ここまでの作業で、ソースコードをバージョン管理することが可能になりました。
しかしこのままでは、もしコンピューターがクラッシュしてしまった場合、全てのソースコードは失われてしまうでしょう。
もしくは別のコンピューターでソースコードを取得したい場合、わざわざメールサービスなどに添付して転送する必要があります。
Gitをより効果的に使用するためにはGitのホスティングサービスの利用が有効です。
Gitのホスティングサービスは色々ありますが、今回の講義ではGitHubを使用したいと思います。

以下の手順によりGitHubの使用を開始し、必要な設定を完了してください。
(既にGitHubへの登録が完了している場合は次のCapterへ進んでください)

1. `https://github.com/` にアクセス
2. 入力用ボックスに登録用のメールアドレスを入力し、 [Sign up for GitHub] をクリック
3. 必要項目を入力し、[Create account] ボタンをクリック
4. Welcome画面が表示されるので、下のほうにスクロールして [Complete setup] をクリック
5. 入力したメールアドレス宛に確認メールが送信されているので、本文中の [Verify email address] をクリック

## Chapter 5: GitHubへのSSHキー登録

前回のChapterでGitHubへの登録は完了したと思います。
ですがGitHubから自身のコンピューター上にソースコードを複製したり、編集した内容をGitHubのリポジトリに反映させたりしたい場合、GitHubと通信するための認証が必要になります。
認証方法はGitHubとの通信プロトコル(httpsやssh)によって異なります。
GitHubの推奨はhttpsとパーソナルトークンを使用した通信方法ですが、実際の開発現場ではSSHを使用するほうが多いと思います。
なので今回はSSHでの接続設定を行っていきます。
下記の手順、またはGitHub公式が公開している手順にしたがって設定を行ってください。(GitHub公式リファレンス: [GitHub に SSH で接続する](https://docs.github.com/ja/authentication/connecting-to-github-with-ssh))
下記はMacOSまたはLinuxを使用した際の手順になります。
WindowsOSでのWSLやPowerShellを使用した手順は別途ご自身で調べてください。
(既にSSH keyの登録が完了している場合は次のCapterへ進んでください)

1. CLIウィンドウを開く
2. 下記コマンドを実行
    ```sh
    ssh-keygen -t ed25519 -f ~/.ssh/github
    # パスフレーズを聞かれるのでフレーズを入力し、それを忘れないようにしてください。

    echo 'Host github.com' >> ~/.ssh/config
    echo '  HostName github.com' >> ~/.ssh/config
    echo '  User git' >> ~/.ssh/config
    echo '  HostName github.com' >> ~/.ssh/config
    echo '  IdentityFile ~/.ssh/github' >> ~/.ssh/config
    echo '  IdentitiesOnly yes' >> ~/.ssh/config
    # 上記でsshのconfigファイルを編集しています。これによりgithub.comとのSSH接続時にどのキーファイルを使うかを自動で選択してくれます。
    ```
3. 自動作成された`~/.ssh/github.pub`ファイル内のテキストを全てコピー
4. `https://github.com/settings/keys` にアクセスし [New SSH key] をクリック
5. Titleを適当に入力しKeyの入力エリアに、先程コピーしたテキストをペースト
6. [Add SSH key]をクリック

## Chapter 6: リモートリポジトリの作成

GitHubへのSSH接続が可能になったので、次にGitHub上にもリポジトリを作成したいと思います。

1.GitHubにサインインした状態で`https://github.com/`にアクセス
2. Recent Repositories の横にある[New]をクリック
3. Repository name に任意の文字列を入力
4. Private を選択
5. [Create repository]ボタンをクリック

## Chapter 7: リモートリポジトリとの同期

リモートリポジトリの作成が完了したら、自身のコンピューター上にあるローカルリポジトリと同期させていきましょう。
まずはリモートリポジトリの同期先情報をコピーします。
GitHubで作成したリポジトリの管理画面を開き、[Code]をクリック。
SSHを選択し、表示されたテキストをコピーしてください。(例: git@github.com:USER_NAME/REPOSITORY_NAME)

次に以下のコマンドを任意のCLIで実行します。

```sh
git remote add origin COPIED_TEXT
# COPIED_TEXT は先程コピーした内容に置き換えてください。
```

これでローカルリポジトリに同期先のリモートリポジトリが設定されました。
以下のコマンドで現在のローカルブランチの状態をリモートブランチに反映してみましょう。

```sh
git push -u origin lesson/how_to_use_git
# `-u`オプションは上流ブランチを設定します。
# これでこのブランチでは次回から`git push`のみで、自動的にリモートリポジトリの同名ブランチへpushされるようになります。
```

GitHub上のリポジトリを確認してみてください。
ローカルで作成したブランチが１つ追加され、ファイルの内容も同じになっているはずです。

## Chapter 8: リポジトリのクローン

ここで、一度学んだことを整理しましょう。

1. 自身のコンピューター上(ローカル)でリポジトリを作成
2. 開発用ブランチの作成と切り替え
3. addとcommitコミットコマンドによる変更履歴の作成
4. Gitのホスティングサービスを利用したリモートリポジトリの作成
5. ローカルリポジトリとリモートリポジトリの同期

これらは個人開発でも必要になる知識です。
それでは、ここからはチーム開発で必要になる知識を学んでいきましょう。

あなたがチームの開発に参加したとします。
その際、誰かが既にリモートリポジトリを作成し、いくつかの変更履歴(コミット履歴)があるとします。
まず、あなたはこれらの内容を複製したローカルリポジトリを、自身のコンピューター上に配置しなくてはなりません。
その際に使用されるコマンドが`git clone`です。

今回は、ここまでの講義で作成したリモートリポジトリをクローンしてみましょう。
すでにリモートリポジトリと同期したローカルリポジトリが存在しますが、一旦こちらのディレクトリの名前をリモートリポジトリの名前と別の名前に変更しておいてください。 (元々別名の場合はそのままでかまいません)
ちなみにもうおわかりかもしれませんが、ローカルリポジトリとはあなたが最初に`git init`を実行したディレクトリのことです。

その後、GitHubのリポジトリの管理画面を開き、[Code]をクリック。
SSHを選択し、表示されたテキストをコピーしてください。(例: git@github.com:USER_NAME/REPOSITORY_NAME)
さらに以下のコマンドを自身のCLIで実行します。

```sh
git clone COPIED_TEXT
# COPIED_TEXT は先程コピーした内容に置き換えてください。
```

`git clone`を実行したディレクトリ配下に、リポジトリ名と同じディレクトリが作成されていれば成功です。
それがリモートリポジトリを複製してできたローカルリポジトリです。
そのディレクトリに移動したあと、`git log`コマンドなどで履歴を確認してみてください。リモートの内容と同じはずです。

## Chapter 9: 他人の変更をプルする

今あなたのコンピューター上に同じリモートリポジトリが設定された２つのローカルリポジトリがあります。
普通こんなことはしません。あくまでチーム開発を経験する講義のためであることを認識してください。
仮に、最初に作成したローカルリポジトリを「開発者A」のコンピューター上にあるリポジトリ、さきほど作成したものを「開発者B」のコンピューター上にあるリポジトリのようにイメージするといいでしょう。

他人がリモートリポジトリに反映した変更履歴を取り込むためにはローカルリポジトリ内で`git pull`コマンドを使用し、変更内容を引っ張ってくる必要があります。
実演してみましょう。

まずは「開発者A」のリポジトリに移動し、ファイルに何かしらの変更を加えてください。
その後、この講義で教えたことを参考に、`git add`, `git commit`, `git push`を使用し、リモートリポジトリに反映させてください。

リモートリポジトリへの反映が確認できたら、今度はその変更を「開発者B」のリポジトリへ取り込みます。
「開発者B」のリポジトリに移動し、`git switch`を使用して、変更を加えたブランチに切り替えてください。
念の為、この時点でのログを確認しましょう。`git log`を実行してください。
まだ「開発者A」で行った変更はありませんね？
では、以下のコマンドを使用してください。

```sh
git pull
```

`git log`でログを確認してください。
「開発者A」で行った変更が無事確認できれば成功です。

## Chapter 10: マージによるコミット履歴の統合とコンフリクト解決

次に、コミット履歴を別のブランチへ統合してみましょう。
今、あなたのリポジトリには`master`ブランチと`lesson/how_to_use_git`ブランチが存在していると思います。
`master`ブランチに`lesson/how_to_use_git`ブランチのコミット履歴を統合するのはあとでGitHub上で行いたいので、一度`master`ブランチに切り替えてから新しいブランチを作成してください。

```sh
git switch master
git switch -c lesson/branch_for_using_on_merge_lesson
```

作成が完了したら一度ログを確認してみてください。

```sh
git log
```

まだ`master`ブランチと同じコミット履歴しか無い状態ですね。
では一度コミットを作成してみましょう。
以下のコマンドでコミット履歴を作成してください。

```sh
echo 'I have no particular meaning.' > noMeaningText.txt
git add noMeaningText.txt
git commit -m 'This commit will be merged without any problems.'
echo '# Merge & Conflict resolution lesson' > README.md
git add README.md
git commit -m 'This commit causes a conflict.'
```

## Chapter 12: プルリクエスト(マージリクエスト)の作成
